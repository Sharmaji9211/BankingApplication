package com.shiva.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.SessionAttribute;
import org.springframework.web.servlet.ModelAndView;
import com.shiva.models.TransactionInfo;
import com.shiva.services.AccountService;

@Controller
@RequestMapping("/services")

public class TransferController 
{
	@Autowired
	private AccountService accountService;
	
	@GetMapping("/transfer-form")
	public String getTransfer() {
		return "service/transfer/transfer-money-form";
	}
	@GetMapping("/verify-account.do")
	public String verifyRecipientAccountNo(int raccountno,@SessionAttribute int accountno,Model model)
	{
		if(raccountno==accountno)
		{
			model.addAttribute("raccountno",raccountno);
			model.addAttribute("msg","This is your own acocunt number");
			return "service/transfer/transfer-money-form";	
		}
		//Check existence of recipient account number in db
//		if()
//		{
//			model.addAttribute("raccountno",raccountno);
//			model.addAttribute("msg","Entered acocunt number does not exist");
//			return "service/transfer/transfer-money-form";	
//		}
		return "service/transfer/transfer-money-form2";
	}
	@GetMapping("/transfer.do")
	public ModelAndView getTransferMoney(int amount , @SessionAttribute int accountno) {
	    int currentAmount = accountService.getAmount(accountno);
	    ModelAndView modelAndView = new ModelAndView("service/withdraw/withdraw-money-success");

	    if(currentAmount < amount) {

	        modelAndView.addObject("amount", amount);
	        modelAndView.addObject("msg", "Sorry!! you do not have sufficient amount");
	        modelAndView.setViewName("service/withdraw/withdraw-money-form");
	    } else {
	        TransactionInfo transaction = accountService.withdrawMoney(accountno, amount);
	        modelAndView.addObject("transaction", transaction);
	    }
	    return modelAndView;
	}

}
