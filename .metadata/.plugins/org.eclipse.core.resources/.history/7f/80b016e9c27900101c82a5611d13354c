<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Bank Statement</title>

    <!-- Bootstrap CSS (Optional for styling) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- html2pdf.js library for PDF download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <style>
        th, td {
            text-align: left;
        }
        .scrollit {
            overflow: scroll;
            max-height: 45vh;
        }
        .scrollit thead th {
            position: sticky;
            background: teal;
            color: white;
            top: 0;
        }
    </style>
</head>
<body class="bg-light text-center">

<!-- Header if needed -->
<div th:insert="~{reusable-code/header}"></div>

<div class="bg-image">
    <div class="container py-1">
        <div class="card mx-auto shadow" style="max-width:100%;">
            <div class="card-body" style="height:23vw">
                <!-- ðŸ§¾ This is the part to be downloaded -->
                <div id="receipt-content" class="table scrollit">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>From Account</th>
                                <th>To Account</th>
                                <th>Amount</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="tr, iterStat : ${statementList}">
                                <td th:text="${iterStat.index + 1}"></td>
                                <td th:text="${tr.fromaccount}"></td>
                                <td th:text='${tr.toaccount == tr.fromaccount ? "Self" : tr.toaccount}'></td>
                                <td th:class='${tr.type == "Credit" ? "text-success" : "text-danger"}' th:text="'â‚¹' + ${tr.amount}"></td>
                                <td th:text="${tr.date}"></td>
                                <td th:text="${tr.time}"></td>
                                <td th:class='${tr.type == "Credit" ? "text-success" : "text-danger"}' th:text="${tr.type}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ðŸ“¥ Download & Home Buttons -->
    <div class="my-3">
        <a href="/bankingApp" class='btn btn-primary'>Back Home</a>
        <button class='btn btn-secondary' onclick="downloadPDF()">Download Receipt</button>
    </div>
</div>

<!-- Footer if needed -->
<div th:insert="~{reusable-code/footer}"></div>

<!-- ðŸ“œ JavaScript for PDF Download -->
<script>
    function downloadPDF() {
        const element = document.getElementById("receipt-content");

        const opt = {
            margin: 0.5,
            filename: 'Bank-Statement.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save();
    }
</script>

</body>
</html>
